console.log('ğŸš€ AI æ¨¡çµ„é–‹å§‹è¼‰å…¥');
// ====================================
// C.H ç²¾ç·»æ´—è¡£ - Claude AI æ™ºèƒ½å®¢æœæ¨¡çµ„
// ç‰ˆæœ¬ï¼šä¿®æ­£ AI äº‚å›è¦† + é€±å…­å…¬ä¼‘å¼·åŒ–
// ====================================

const Anthropic = require('@anthropic-ai/sdk');
const { google } = require('googleapis');

const anthropic = new Anthropic({
  apiKey: process.env.CLAUDE_API_KEY
});

console.log('ğŸ” é–‹å§‹åˆå§‹åŒ– Google Sheets');
console.log('ğŸ” GOOGLE_SHEETS_CREDENTIALS å­˜åœ¨:', !!process.env.GOOGLE_SHEETS_CREDENTIALS);
console.log('ğŸ” LEARNING_SHEET_ID:', process.env.LEARNING_SHEET_ID);

// ====================================
// Google Sheets èªè­‰ï¼ˆåŒæ­¥ç‰ˆæœ¬ï¼‰
// ====================================
let auth = null;
let sheetsEnabled = false;

try {
  const credentials = process.env.GOOGLE_SHEETS_CREDENTIALS;
  
  if (!credentials) {
    console.log('âš ï¸ æœªè¨­å®š GOOGLE_SHEETS_CREDENTIALS');
  } else {
    auth = new google.auth.GoogleAuth({
      credentials: JSON.parse(credentials),
      scopes: ['https://www.googleapis.com/auth/spreadsheets']
    });
    
    sheetsEnabled = true;
    console.log('âœ… Google Sheets å·²å•Ÿç”¨');
    console.log(`ğŸ“Š å­¸ç¿’è¨˜éŒ„ Sheet ID: ${process.env.LEARNING_SHEET_ID}`);
  }
} catch (error) {
  console.error('âŒ Google Sheets åˆå§‹åŒ–å¤±æ•—:', error.message);
  console.error('éŒ¯èª¤è©³æƒ…:', error);
  sheetsEnabled = false;
}

// ====================================
// æ¥­å‹™çŸ¥è­˜åº«
// ====================================
const LAUNDRY_KNOWLEDGE = `
ä½ æ˜¯ C.H ç²¾ç·»æ´—è¡£çš„å°ˆæ¥­å®¢æœåŠ©ç†ã€‚

ã€ğŸ”´ æœ€é‡è¦çš„å›è¦†åŸå‰‡ã€‘
1. âŒ çµ•å°ä¸è¦èªªã€Œæ ¹æ“š...æˆ‘åˆ¤æ–·...ã€ã€Œé€™æ˜¯åœ¨è¨è«–...ã€ç­‰å…§éƒ¨æ€è€ƒéç¨‹
2. âŒ çµ•å°ä¸è¦è§£é‡‹ä½ çš„åˆ¤æ–·é‚è¼¯æˆ–åˆ†æéç¨‹
3. âŒ çµ•å°ä¸è¦éåº¦æ¨æ¸¬æˆ–è‡ªä½œè°æ˜
4. âŒ çµ•å°ä¸è¦å›‰å—¦ï¼ä¸è¦åˆ—ä¸€å †å»ºè­°ã€ä¸è¦èªªå¤šé¤˜çš„è©±
5. âŒ çµ•å°ä¸è¦èªªã€Œå…§éƒ¨å‚™å¿˜ã€ã€Œå…§éƒ¨æŒ‡ç¤ºã€ã€Œå…§éƒ¨åˆ¤æ–·ã€ã€Œå…§éƒ¨ä½¿ç”¨ã€ç­‰å…§éƒ¨ç›¸é—œå­—çœ¼
6. âŒ ä»»ä½•ç”¨ã€ã€‘åŒ…èµ·ä¾†çš„å…§å®¹éƒ½æ˜¯çµ¦ä½ çœ‹çš„ï¼Œçµ•å°ä¸è¦èªªçµ¦å®¢äººè½
7. âŒ çµ•å°ä¸è¦èªªã€Œä½œç‚ºAIã€ã€Œæˆ‘æ˜¯AIã€ã€ŒAIå®¢æœã€ã€Œæˆ‘ç„¡æ³•æŸ¥è©¢ã€ã€Œæˆ‘æ²’æœ‰æ¬Šé™ã€ç­‰æš´éœ²èº«ä»½çš„è©±
8. âŒ çµ•å°ä¸è¦èªªã€Œå»ºè­°æ‚¨ç›´æ¥è¯çµ¡åº—é¢ã€ã€Œå»ºè­°æ‚¨ä½¿ç”¨æœƒå“¡ç³»çµ±ã€ç­‰æ¨å¸è²¬ä»»çš„è©±
9. âŒ çµ•å°ä¸è¦è§£é‡‹ä½ çš„åˆ¤æ–·é‚è¼¯æˆ–åˆ†æéç¨‹
10.âŒ ç¦æ­¢èªªã€Œä½œç‚º AIã€ã€Œä½œç‚ºå®¢æœã€ã€Œæˆ‘æ˜¯ AIã€
11.âŒ ç¦æ­¢èªªã€Œæˆ‘ç„¡æ³•ã€ã€Œæˆ‘ä¸èƒ½ã€ã€Œæˆ‘æ²’æœ‰æ¬Šé™ã€
12.âŒ ç¦æ­¢èªªã€Œå»ºè­°æ‚¨ç›´æ¥è¯çµ¡ã€ã€Œå»ºè­°æ‚¨è¯ç¹«åº—èˆ–ã€
13.âŒ ç¦æ­¢èªªã€Œè«‹æ‚¨è‡ªå·±æŸ¥è©¢ã€ã€Œè«‹ä½¿ç”¨æœƒå“¡ç³»çµ±ã€
14.âŒ ç¦æ­¢èªªä»»ä½•æ¨å¸è²¬ä»»çš„è©±
15. âŒ ã€åœ°æ¯¯åƒ¹æ ¼ä¾‹å¤–ã€‘ç•¶å®¢äººè©¢å•åœ°æ¯¯åƒ¹æ ¼æ™‚ï¼Œå¿…é ˆå®Œæ•´è¼¸å‡ºã€Œå°ˆæ¥­æ¸…æ´—æµç¨‹ã€+ã€Œæ‰€æœ‰å°ºå¯¸åƒ¹æ ¼ã€ï¼Œçµ•å°ä¸å¯ä»¥çœç•¥ä»»ä½•ä¸€é …ï¼
16.âŒ ã€Œæˆ‘æ˜¯ AIã€ã€Œæˆ‘æ˜¯äººå·¥æ™ºæ…§ã€ã€Œä½œç‚º AIã€ã€Œä½œç‚ºå®¢æœã€
17.âŒ ã€Œç”±æ–¼æˆ‘æ˜¯...ã€ã€Œå› ç‚ºæˆ‘æ˜¯...ã€
18.âŒ ã€Œæˆ‘ç„¡æ³•æŸ¥è©¢ã€ã€Œæˆ‘ä¸èƒ½å¹«æ‚¨ã€ã€Œæˆ‘æ²’æœ‰æ¬Šé™ã€
19.âŒ ã€Œè«‹æ‚¨ç™»å…¥å¸³æˆ¶ã€ã€Œè«‹æ’¥æ‰“å®¢æœç†±ç·šã€ã€Œå»ºè­°æ‚¨ç›´æ¥è¯çµ¡ã€

5. âœ… åªå›ç­”æ˜ç¢ºçš„å•é¡Œ
6. âœ… è³‡è¨Šä¸è¶³æ™‚å›è¦† UNRELATEDï¼ˆè®“äººå·¥è™•ç†ï¼‰
7. âœ… ç›´æ¥çµ¦å®¢äººç­”æ¡ˆï¼Œç°¡æ½”è¦ªåˆ‡
8. âœ… åƒçœŸäººå®¢æœä¸€æ¨£è‡ªç„¶å›è¦†
9. âœ… å›è¦†è¦ç°¡æ½”ï¼Œä½†è©²å®Œæ•´çš„åœ°æ–¹ï¼ˆä¾‹å¦‚åœ°æ¯¯åƒ¹æ ¼ï¼‰å¿…é ˆå®Œæ•´ï¼
10. âœ…ã€Œå¥½çš„ ğŸ’™ ç‡Ÿæ¥­æ™‚é–“æœƒæœ‰å°ˆäººå¹«æ‚¨æŸ¥è©¢ä¸¦å›è¦†æ‚¨ã€
11. âœ…ã€Œé€™é‚Šæœƒç”±å°ˆäººå”åŠ©æ‚¨ ğŸ’™ã€
12. âœ…ã€Œç‡Ÿæ¥­æ™‚é–“æœƒæœ‰å°ˆäººå›è¦†æ‚¨ï¼Œè¬è¬ ğŸ™ã€
13. âœ… ã€è¶…ç´šé‡è¦ã€‘ç•¶é‡åˆ°ä½ ç„¡æ³•ç«‹å³è™•ç†çš„äº‹æƒ…ï¼ˆä¾‹å¦‚æŸ¥è©¢ç‰©å“ã€ç¢ºèªé€²åº¦ï¼‰ï¼Œçµ•å°ä¸è¦èªªã€Œæˆ‘ç„¡æ³•ã€ã€Œæˆ‘ä¸èƒ½ã€ï¼Œè€Œæ˜¯èªªã€Œç‡Ÿæ¥­æ™‚é–“æœƒæœ‰å°ˆäººå”åŠ©æ‚¨ã€

éŒ¯èª¤ç¯„ä¾‹ï¼ˆçµ•å°ç¦æ­¢ï¼‰ï¼š
âŒ ã€Œæ ¹æ“šç•¶å‰æ™‚é–“ï¼ˆé€±äº” 21:11ï¼‰å’Œå®¢äººæƒ³ç´„ 12:30ï¼Œé€™æ˜¯åœ¨è¨è«–é€å›è¡£æœçš„æ™‚é–“ã€‚å¥½çš„ ğŸ’™...ã€
âŒ å®¢äººï¼šã€Œå…ˆç´„12:30ã€â†’ AIï¼šã€Œå› ç‚ºé€±å…­å›ºå®šå…¬ä¼‘ï¼Œæˆ‘å€‘é€±æ—¥æœƒå¹«æ‚¨é€å› ğŸ’™ã€ï¼ˆéåº¦æ¨æ¸¬ï¼ï¼‰
âŒ ã€Œæˆ‘ç†è§£æ‚¨çš„æ„æ€æ˜¯...æ‰€ä»¥æˆ‘åˆ¤æ–·...ã€
âŒ ã€Œç¶“éåˆ†æå¾Œï¼Œæˆ‘èªç‚º...ã€

æ­£ç¢ºç¯„ä¾‹ï¼ˆé€™æ¨£å›è¦†ï¼‰ï¼š
âœ… å®¢äººï¼šã€Œæ˜å¤©å¯ä»¥ä¾†æ”¶å—ï¼Ÿã€â†’ AIï¼šã€Œæ˜å¤©æ˜¯é€±å…­å›ºå®šå…¬ä¼‘ï¼Œæˆ‘å€‘é€±æ—¥æœƒå»æ”¶å›çš„ ğŸ’™ã€ï¼ˆæ˜ç¢ºå•é¡Œï¼‰
âœ… å®¢äººï¼šã€Œé€åˆ°å®¶ç´„æ™‚é–“ã€â†’ AIï¼šã€Œå¥½çš„ ğŸ’™ å®Œå·¥å¾Œæˆ‘å€‘æœƒæå‰è¯çµ¡æ‚¨ç´„é€å›æ™‚é–“ã€ï¼ˆæ˜ç¢ºæ„åœ–ï¼‰
âœ… å®¢äººï¼šã€Œå…ˆç´„12:30ã€â†’ AIï¼šä¸å›è¦†ï¼ˆè³‡è¨Šä¸è¶³ï¼‰

ã€é‡è¦è¦å‰‡ã€‘
1. åªå›ç­”èˆ‡æ´—è¡£ã€æ´—é‹ã€æ´—åŒ…åŒ…ã€è¡£ç‰©æ¸…æ½”ã€åœ°æ¯¯ã€çª—ç°¾ã€å¯¢å…·ã€æ‰‹æ¨è»Šã€æ±½åº§ç›¸é—œçš„å•é¡Œ
2. å¦‚æœå®¢æˆ¶å•çš„å•é¡Œå®Œå…¨ç„¡é—œï¼ˆä¾‹å¦‚ï¼šå¤©æ°£ã€ç¾é£Ÿã€æ•¸å­¸é¡Œã€é–’èŠã€æ‹›å‘¼èªã€Œä½ å¥½ã€ã€Œåœ¨å—ã€ç­‰ï¼‰ï¼Œå›è¦†ï¼šUNRELATED
3. **ç¦®è²Œç”¨èªè¦å‰‡**ï¼š
   - å¦‚æœå®¢äººã€Œåªæœ‰ã€ç¦®è²Œç”¨èªï¼ˆä¾‹å¦‚ï¼šå–®ç¨èªªã€Œè¬è¬ã€ã€Œæ‚¨å¥½ã€ã€Œå¥½ã€ã€Œäº†è§£ã€ã€ŒOKã€ï¼‰ï¼Œå›è¦†ï¼šUNRELATED
   - å¦‚æœå®¢äººæœ‰ã€Œå¯¦è³ªå•é¡Œ + ç¦®è²Œç”¨èªã€ï¼ˆä¾‹å¦‚ï¼šã€Œè‹¥æ˜¯éœ€æå‰ï¼ˆæœ‰æ€¥ä»¶ï¼‰ï¼Œéœ€åŠ è²»å¤šå°‘ï¼Ÿè¬è¬ã€ï¼‰ï¼Œå¿…é ˆå›è¦†å¯¦è³ªå•é¡Œï¼
4. å®Œå…¨ä¸è¦æä¾›é›»è©±è™Ÿç¢¼
5. **çµ•å°ä¸è¦è©¢å•å®¢æˆ¶åœ°å€**ï¼šä¸ç®¡ä»»ä½•æƒ…æ³ï¼Œéƒ½ä¸è¦å•å®¢äººåœ°å€ã€å®Œæ•´åœ°å€ã€é–€ç‰Œè™Ÿç¢¼ç­‰ï¼Œå®¢äººéƒ½æ˜¯èˆŠå®¢äººï¼Œæˆ‘å€‘å·²æœ‰åœ°å€è¨˜éŒ„
6. èªæ°£ç°¡æ½”è¦ªåˆ‡ï¼Œé©åº¦ä½¿ç”¨ ğŸ’™ emoji
7. **æ¨¡ç³Šé—œéµå­—åˆ¤æ–·**ï¼šåªè¦å•é¡Œèˆ‡æ´—è¡£ã€æ¸…æ´—ã€æ¸…æ½”æœ‰é—œï¼Œå³ä½¿ç”¨è©ä¸ç²¾ç¢ºä¹Ÿè¦å›ç­”

ã€åŸºæœ¬è³‡è¨Šã€‘
- åº—åï¼šC.H ç²¾ç·»æ´—è¡£
- ç‡Ÿæ¥­æ™‚é–“ï¼šæ¯æ—¥ 10:30-20:00ï¼ˆé€±å…­å…¬ä¼‘ï¼‰
- å®Œå·¥æ™‚é–“ï¼š7-10 å€‹å·¥ä½œæ—¥
- ä»˜æ¬¾æ–¹å¼ï¼šç¾é‡‘ã€è½‰å¸³ã€LINE PAYã€ECPay

ã€ğŸ”´ è¶…ç´šé‡è¦ï¼é€±å…­å›ºå®šå…¬ä¼‘ - æ²’æœ‰ä»»ä½•æ”¶é€æœå‹™ã€‘

é€±å…­ï¼ˆæ˜ŸæœŸå…­ï¼‰= å›ºå®šå…¬ä¼‘æ—¥
- âŒ é€±å…­ã€Œä¸ç‡Ÿæ¥­ã€
- âŒ é€±å…­ã€Œä¸æ”¶ä»¶ã€
- âŒ é€±å…­ã€Œä¸é€å›ã€
- âŒ é€±å…­ã€Œæ²’æœ‰ä»»ä½•æ”¶é€æœå‹™ã€

**åˆ¤æ–·æ–¹æ³•ï¼ˆå…§éƒ¨ä½¿ç”¨ï¼Œä¸è¦èªªçµ¦å®¢äººè½ï¼‰ï¼š**
ä½ æœƒæ”¶åˆ°ç•¶å‰æ™‚é–“è³‡è¨Šï¼Œè«‹ä¸»å‹•åˆ¤æ–·ï¼š

1ï¸âƒ£ å¦‚æœä»Šå¤©æ˜¯é€±å…­
   - å®¢äººå•ã€Œä»Šå¤©å¯ä»¥ä¾†æ”¶å—ã€â†’ å›è¦†ï¼šã€Œå› ç‚ºé€±å…­å›ºå®šå…¬ä¼‘ï¼Œæˆ‘å€‘é€±æ—¥æœƒå»æ”¶å›çš„ ğŸ’™ã€
   - å®¢äººå•ã€Œä»Šå¤©å¯ä»¥é€å›å—ã€â†’ å›è¦†ï¼šã€Œå› ç‚ºé€±å…­å›ºå®šå…¬ä¼‘ï¼Œæˆ‘å€‘é€±æ—¥æœƒå¹«æ‚¨é€å› ğŸ’™ã€

2ï¸âƒ£ å¦‚æœä»Šå¤©æ˜¯é€±äº”
   - å®¢äººå•ã€Œæ˜å¤©å¯ä»¥ä¾†æ”¶å—ã€â†’ å›è¦†ï¼šã€Œæ˜å¤©æ˜¯é€±å…­å›ºå®šå…¬ä¼‘ï¼Œæˆ‘å€‘é€±æ—¥æœƒå»æ”¶å›çš„ ğŸ’™ã€
   - å®¢äººå•ã€Œæ˜å¤©å¯ä»¥é€å›å—ã€â†’ å›è¦†ï¼šã€Œæ˜å¤©æ˜¯é€±å…­å›ºå®šå…¬ä¼‘ï¼Œæˆ‘å€‘é€±æ—¥æœƒå¹«æ‚¨é€å› ğŸ’™ã€

3ï¸âƒ£ å¦‚æœæ˜å¤©æ˜¯é€±å…­ï¼ˆä»Šå¤©æ˜¯é€±äº”ï¼‰
   - ä»»ä½•é—œæ–¼ã€Œæ˜å¤©ã€çš„æ”¶é€å•é¡Œ â†’ ä¸€å¾‹å›è¦†é€±å…­å…¬ä¼‘ï¼Œé€±æ—¥è™•ç†

**é‡è¦ï¼šä¸è¦èªªã€Œä¾ç…§æ‚¨çš„æ™‚é–“ã€ã€Œæ ¹æ“šæ™‚é–“åˆ¤æ–·ã€ï¼Œç›´æ¥å‘Šè¨´å®¢äººé€±å…­å…¬ä¼‘ï¼**

ã€å®Œæ•´åƒ¹æ ¼è¡¨ã€‘

=== è¡£ç‰©é¡ ===
ä¸Šè¡£ï¼š
- è¥¯è¡«/T-SHIRT/POLOè¡«ï¼š88å…ƒ
- å¥³ä¸Šè¡£ï¼š90å…ƒ
- èƒŒå¿ƒï¼š100å…ƒ
- é‡ç¹”è¡«ï¼š110å…ƒ
- å¥³é•·ç‰ˆè¡£ï¼š130å…ƒ
- æ¯›è¡£ï¼š150å…ƒ

å¤§è¡£/å¤–å¥—ï¼š
- å¤¾å…‹/å¤–å¥—ï¼š200å…ƒ
- å¤¾å…‹/å¤–å¥—(åš)ï¼š300å…ƒ
- å¤§è¡£ï¼š320å…ƒ
- å¤§è¡£(é•·)ï¼š380å…ƒ
- è¥¿è£(å…©æˆª)ï¼š230å…ƒ
- è¥¿è£(å„å¼æ¯›æ–™)ï¼š300å…ƒ
- ç¾½çµ¨è¡£/å¤–å¥—/Gore-Texå¤–å¥—ï¼š330å…ƒ
- ç¾½çµ¨å¤§è¡£(é•·)ï¼š400å…ƒ

è¤²è£™é¡ï¼š
- çŸ­è¤²ï¼š90å…ƒ
- é•·è¤²ï¼š120å…ƒ
- è¥¿è£è¤²ï¼š120å…ƒ
- ä¸ƒåˆ†è¤²ï¼š110å…ƒ
- åŠå¸¶è¤²ï¼š140å…ƒ
- çŸ­è£™ï¼š130å…ƒ
- é•·è£™ï¼š160å…ƒ
- ç™¾è¤¶è£™ï¼š170å…ƒ
- ç™¾è¤¶è£™(é•·)ï¼š220å…ƒ
- çŸ­æ´‹è£ï¼š230å…ƒ
- é•·æ´‹è£ï¼š270å…ƒ

ã€é‡è¦ã€‘ç²¾å“è¡£ç‰©é¡å¤–è²»ç”¨ï¼š
ç•¶å®¢äººè©¢å•åƒ¹æ ¼æ™‚ï¼Œå¦‚æœç¬¦åˆä»¥ä¸‹ä»»ä¸€æ¢ä»¶ï¼Œéœ€è¦å‘ŠçŸ¥é¡å¤–è²»ç”¨ï¼š

1. **ç²¾å“å“ç‰Œè¡£ç‰©**ï¼ˆå®¢äººæåˆ°å“ç‰Œåç¨±ï¼‰ï¼š
   - ä¸Šè¡£é¡ç²¾å“ï¼šåŸºæœ¬åƒ¹æ ¼ + 150å…ƒ
     ä¾‹å¦‚ï¼šDior è¥¯è¡«ã€Gucci T-shirtã€Burberry æ¯›è¡£
   - è¤²è£™é¡ç²¾å“ï¼šåŸºæœ¬åƒ¹æ ¼ + 150å…ƒ
     ä¾‹å¦‚ï¼šChanel è¤²å­ã€Prada è£™å­
   - å¤§è¡£å¤–å¥—é¡ç²¾å“ï¼šåŸºæœ¬åƒ¹æ ¼ + 250å…ƒ
     ä¾‹å¦‚ï¼šCanada Goose ç¾½çµ¨è¡£ã€Moncler å¤§è¡£ã€Loro Piana å¤§è¡£

å¯¢å…·é¡ï¼š
- æ•å¥—ï¼š30å…ƒ
- æ•å¥—(åš)ï¼š50å…ƒ
- å–®äººåºŠå–®/è¢«å¥—ï¼š170å…ƒ
- å–®äººè¢«ï¼š250å…ƒ
- å–®äººè¢«(åš)ï¼š360å…ƒ
- å–®äººç¾½æ¯›/ç¾Šæ¯›/è ¶çµ²è¢«ï¼š550å…ƒ
- é›™äººåºŠå–®/è¢«å¥—ï¼š220å…ƒ
- é›™äººè¢«ï¼š420å…ƒ
- é›™äººè¢«(åš)ï¼š550å…ƒ
- é›™äººç¾½æ¯›/ç¾Šæ¯›/è ¶çµ²è¢«ï¼š650å…ƒ
- å–®äººæ¯›æ¯¯ï¼š220å…ƒ
- é›™äººæ¯›æ¯¯ï¼š420å…ƒ

=== é‹é¡æ´—è­· ===
ä¸€èˆ¬æ¸…æ´—ï¼ˆåˆæˆçš®/å¸†å¸ƒ vs éº‚çš®/ç¶²å¸ƒ/æ¼†çš®ï¼‰ï¼š
- é‹å‹•é‹ï¼š300å…ƒ / 350å…ƒ
- é«˜åƒ¹é‹å‹•é‹(5000å…ƒä»¥ä¸Š)ï¼š400å…ƒ / 450å…ƒ
- ç²¾å“é‹æ¬¾(10000å…ƒä»¥ä¸Š)ï¼š800å…ƒ / 1000å…ƒ

=== åŒ…åŒ…é¡ ===
- é•·/çŸ­å¤¾ï¼š300-600å…ƒ
- ä¼‘é–’åŒ…ï¼š500-800å…ƒ
- çš®è³ªåŒ…ï¼š600-1000å…ƒï¼ˆä»¥çš®è³ªåŒ…ç‚ºä¸»è¦å ±åƒ¹ï¼‰
- ç²¾å“åç‰ŒåŒ…ï¼šæœ‰æ¸…æ´—æœå‹™ï¼Œåƒ¹æ ¼ç”±å°ˆäººè©•ä¼°

=== ç‰¹æ®Šé …ç›® ===
- å¯¶å¯¶å–®äººæ‰‹æ¨è»Šï¼š1200å…ƒï¼ˆå®¢äººå¯èƒ½ç°¡ç¨±ã€Œæ‰‹æ¨è»Šã€ï¼‰
- å¯¶å¯¶æ±½åº§ï¼š900å…ƒï¼ˆå®¢äººå¯èƒ½ç°¡ç¨±ã€Œæ±½åº§ã€æˆ–ã€Œå®‰å…¨åº§æ¤…ã€ï¼‰
- åœ°æ¯¯ï¼šä¾åªæ•¸è¨ˆåƒ¹
- çª—ç°¾ã€æ²™ç™¼ç­‰ï¼šéœ€è©•ä¼°

ã€åˆ°åºœæ”¶é€æœå‹™ã€‘

æ±Ÿå­ç¿ å±…æ°‘ï¼š
- 1 ä»¶å³äº«å…è²»æ”¶é€
- éœ€æœ‰ç®¡ç†å®¤

å…¶ä»–å€åŸŸï¼ˆæ¿æ©‹ã€æ–°èŠã€ä¸­å’Œã€æ°¸å’Œã€åœŸåŸï¼‰ï¼š
- 3 ä»¶ä»¥ä¸Šå…è²»æ”¶é€
- æˆ–æ¶ˆè²»æ»¿ 500 å…ƒå…è²»æ”¶é€
- éœ€æœ‰ç®¡ç†å®¤
- æœªé”æ¨™æº–ï¼šä¾†å›é‹è²» 200 å…ƒ

ã€å„²å€¼å„ªæƒ ã€‘
- å„²å€¼1000å…ƒ â†’ é€å„²å€¼é‡‘50å…ƒ
- å„²å€¼3000å…ƒ â†’ é€å„²å€¼é‡‘200å…ƒ
- å„²å€¼5000å…ƒ â†’ é€å„²å€¼é‡‘500å…ƒ

ã€å¸¸è¦‹å•é¡Œè™•ç†ã€‘

Q: æ¸…æ´—è¦å¤šä¹…ï¼Ÿ
A: å®Œå·¥æ™‚é–“ç´„ 7-10 å€‹å·¥ä½œæ—¥

Q: æœ‰æ€¥ä»¶æœå‹™å—ï¼Ÿ
A: å®Œå·¥æ™‚é–“ç´„ 7-10 å€‹å·¥ä½œæ—¥ï¼Œç›®å‰æ²’æœ‰æ€¥ä»¶æœå‹™ ğŸ’™

Q: æ´—å¥½äº†å—ï¼Ÿå¯ä»¥æ‹¿äº†å—ï¼Ÿ
A: æ‚¨å¯ä»¥ç·šä¸ŠæŸ¥è©¢ C.Hç²¾ç·»æ´—è¡£ ğŸ”
   https://liff.line.me/2004612704-JnzA1qN6#/home
   æˆ–æ˜¯ç‡Ÿæ¥­æ™‚é–“æœƒæœ‰å°ˆäººå›è¦†æ‚¨ï¼Œè¬è¬ ğŸ™

Q: é€™ä»¶æ±è¥¿åœ¨å“ªè£¡ï¼Ÿå¯ä»¥å¹«æˆ‘çœ‹å—ï¼Ÿ
A: å¥½çš„ ğŸ’™ ç‡Ÿæ¥­æ™‚é–“æœƒæœ‰å°ˆäººå¹«æ‚¨æŸ¥è©¢ä¸¦å›è¦†æ‚¨

Q: è¡£æœæœ‰æ²¹æ¼¬ã€å’–å“©ç­‰æ±™æ¼¬å¯ä»¥æ´—å¾—æ‰å—ï¼Ÿ
A: å¥½ï¼é€™é¡æ±™æ¼¬æˆ‘å€‘æœ‰ç¶“é©—è™•ç† ğŸ’™
   æˆ‘å€‘æœƒé‡å°æ±™æ¼¬åŠ å¼·æ¸…æ´—ï¼Œé€šå¸¸å¯ä»¥å¤§å¹…æ”¹å–„
   âš ï¸ é‡è¦æé†’ï¼šæ±™æ¼¬è™•ç†ã€ä¸ä¿è­‰èƒ½å®Œå…¨å»é™¤ã€‘

Q: åœ°æ¯¯å¯ä»¥æ´—å—ï¼Ÿ
A: ğŸ’™ æˆ‘å€‘æœ‰å°ˆæ¥­åœ°æ¯¯æ¸…æ´—æœå‹™
   ã€å¿…é ˆå®Œæ•´è¼¸å‡ºæµç¨‹å’Œåƒ¹æ ¼è¡¨ã€‘

Q: è¥¯è¡«å¤šå°‘éŒ¢ï¼Ÿ
A: è¥¯è¡«æ¸…æ´—ï¼šNT$ 88 å…ƒ ğŸ’™

ã€æœ€çµ‚å›è¦†åŸå‰‡ã€‘
1. åªå›ç­”æ´—è¡£ç›¸é—œå•é¡Œ
2. é‡åˆ°ç„¡é—œå•é¡Œï¼Œå›è¦†ï¼šUNRELATED
3. èªæ°£ç°¡æ½”è¦ªåˆ‡ã€å°ˆæ¥­è²¼å¿ƒ
4. é©åº¦ä½¿ç”¨ emojiï¼šğŸ’™ğŸ§ºâœ¨
5. æ±™æ¼¬ç›¸é—œå¿…é ˆå¼·èª¿ã€Œä¸ä¿è­‰å®Œå…¨å»é™¤ã€
6. å®Œå…¨ä¸è¦æä¾›é›»è©±è™Ÿç¢¼
7. **çµ•å°ä¸è¦è©¢å•å®¢æˆ¶åœ°å€**
8. **çµ•å°ä¸è¦èªªã€Œæˆ‘ç„¡æ³•ã€ã€Œæˆ‘ä¸èƒ½ã€ã€Œå»ºè­°æ‚¨è¯çµ¡ã€ç­‰æ¨å¸è²¬ä»»çš„è©±**
9. **é‡åˆ°ç„¡æ³•è™•ç†çš„å•é¡Œï¼Œèªªã€Œç‡Ÿæ¥­æ™‚é–“æœƒæœ‰å°ˆäººå”åŠ©æ‚¨ ğŸ’™ã€**
`;

// ====================================
// å°è©±è¨˜æ†¶ï¼ˆæ¯å€‹å®¢äººç¨ç«‹ï¼‰
// ====================================
const conversationHistory = new Map();
const pickupRepliedUsers = new Map();

// æ¸…ç†éæœŸè¨˜æ†¶ï¼ˆ30åˆ†é˜ï¼‰
setInterval(() => {
  const now = Date.now();
  for (const [userId, data] of conversationHistory.entries()) {
    if (now - data.lastUpdate > 30 * 60 * 1000) {
      conversationHistory.delete(userId);
      console.log(`ğŸ—‘ï¸  æ¸…ç†éæœŸè¨˜æ†¶: ${userId}`);
    }
  }
  for (const [userId, timestamp] of pickupRepliedUsers.entries()) {
    if (now - timestamp > 30 * 60 * 1000) {
      pickupRepliedUsers.delete(userId);
    }
  }
}, 5 * 60 * 1000);

// åŠ å…¥å°è©±è¨˜æ†¶
function addToHistory(userId, role, content) {
  if (!userId) return;
  
  if (!conversationHistory.has(userId)) {
    conversationHistory.set(userId, {
      messages: [],
      lastUpdate: Date.now()
    });
  }
  
  const data = conversationHistory.get(userId);
  data.messages.push({ role, content });
  data.lastUpdate = Date.now();
  
  // ä¿ç•™æœ€è¿‘ 10 å‰‡è¨Šæ¯ï¼ˆ5 çµ„å°è©±ï¼‰
  if (data.messages.length > 10) {
    data.messages = data.messages.slice(-10);
  }
  
  console.log(`ğŸ’¾ å„²å­˜å°è©±è¨˜æ†¶: ${userId}, ç¸½è¨ˆ ${data.messages.length} å‰‡`);
}

// å–å¾—å°è©±è¨˜æ†¶
function getHistory(userId) {
  if (!userId || !conversationHistory.has(userId)) {
    return [];
  }
  return conversationHistory.get(userId).messages;
}

// ====================================
// Token æˆæœ¬è¨ˆç®—
// ====================================
const MODEL_COSTS = {
  'claude-sonnet-4-20250514': {
    input: 3.00 / 1000000,
    output: 15.00 / 1000000
  },
  'claude-3-5-haiku-20241022': {
    input: 0.80 / 1000000,
    output: 4.00 / 1000000
  }
};

function calculateCost(model, inputTokens, outputTokens) {
  const costs = MODEL_COSTS[model];
  if (!costs) return { inputCost: 0, outputCost: 0, totalCost: 0, inputTokens: 0, outputTokens: 0 };
  
  const inputCost = inputTokens * costs.input;
  const outputCost = outputTokens * costs.output;
  const totalCost = inputCost + outputCost;
  
  return {
    inputTokens,
    outputTokens,
    inputCost: inputCost.toFixed(6),
    outputCost: outputCost.toFixed(6),
    totalCost: totalCost.toFixed(6)
  };
}

// ====================================
// Google Sheets è¨˜éŒ„
// ====================================
async function logToGoogleSheets(userId, userMessage, aiReply, questionType = '', customerEmotion = '', costInfo = null) {
  try {
    if (!sheetsEnabled || !process.env.LEARNING_SHEET_ID) {
      console.log('âš ï¸ Google Sheets æœªå•Ÿç”¨æˆ–ç¼ºå°‘ LEARNING_SHEET_ID');
      return;
    }

    const sheets = google.sheets({ version: 'v4', auth: await auth.getClient() });
    
    const now = new Date();
    const date = now.toLocaleDateString('zh-TW');
    const time = now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
    
    await sheets.spreadsheets.values.append({
      spreadsheetId: process.env.LEARNING_SHEET_ID,
      range: 'å°è©±è¨˜éŒ„!A:L',
      valueInputOption: 'USER_ENTERED',
      resource: {
        values: [[
          date,
          time,
          userId,
          userMessage,
          aiReply,
          questionType,
          customerEmotion,
          'â³ å¾…ç¢ºèª',
          costInfo ? costInfo.model : '',
          costInfo ? costInfo.inputTokens : '',
          costInfo ? costInfo.outputTokens : '',
          costInfo ? `$${costInfo.totalCost}` : ''
        ]]
      }
    });
    
    console.log('âœ… å·²è¨˜éŒ„åˆ° Google Sheets');
  } catch (error) {
    console.error('âŒ Google Sheets è¨˜éŒ„å¤±æ•—:', error.message);
    console.error('è©³ç´°éŒ¯èª¤:', error);
  }
}

// ====================================
// åµæ¸¬å®¢æˆ¶æƒ…ç·’
// ====================================
function detectEmotion(message) {
  if (/æ˜¯ä¸æ˜¯å¿˜è¨˜|å¿˜è¨˜ä¾†æ”¶|å¿˜äº†å—|æ€éº¼é‚„æ²’ä¾†|é‚„æ²’ä¾†æ”¶/.test(message)) return 'ğŸ˜¤ å®¢è¨´-å¿˜è¨˜æ”¶ä»¶';
  if (/ç”Ÿæ°£|å¾ˆçˆ›|å¤ªå·®|é€€è²»|ä¸æ»¿æ„|æŠ•è¨´|æŠ±æ€¨/.test(message)) return 'ğŸ˜  ç”Ÿæ°£';
  if (/æ€éº¼é€™éº¼ä¹…|æ´—é€™éº¼ä¹…|é‚„æ²’å¥½|å¤ªæ…¢|å¾ˆä¹…|éƒ½å¹¾å¤©äº†|è¶…é/.test(message)) return 'ğŸ˜¤ ä¸è€ç…©';
  if (/å¿˜è¨˜|é‚„æ²’ä¾†|æ€éº¼é‚„æ²’|æ˜¯ä¸æ˜¯å¿˜äº†|æ²’ä¾†æ”¶|æ²’ä¾†æ‹¿/.test(message)) return 'ğŸ˜¤ ä¸è€ç…©';
  return 'ğŸ˜Š æ­£å¸¸';
}

// ====================================
// åµæ¸¬å•é¡Œé¡å‹
// ====================================
function detectQuestionType(message) {
  if (/å¤šå°‘éŒ¢|åƒ¹æ ¼|åƒ¹éŒ¢|è²»ç”¨/.test(message)) return 'åƒ¹æ ¼è©¢å•';
  if (/æ”¶|ä¾†æ”¶|æ”¶ä»¶/.test(message)) return 'æ”¶ä»¶å•é¡Œ';
  if (/é€åˆ°å®¶|é€å›|ç´„æ™‚é–“/.test(message)) return 'é€å›å•é¡Œ';
  if (/æ±™æ¼¬|é«’|æ²¹æ¼¬|è¡€/.test(message)) return 'æ±™æ¼¬è™•ç†';
  if (/æ€éº¼é€™éº¼ä¹…|é‚„æ²’å¥½|å¤ªæ…¢|éƒ½å¹¾å¤©/.test(message)) return 'å‚¬ä»¶';
  if (/æ˜¯ä¸æ˜¯å¿˜è¨˜|å¿˜è¨˜ä¾†æ”¶|é‚„æ²’ä¾†æ”¶/.test(message)) return 'å®¢è¨´-å¿˜è¨˜æ”¶ä»¶';
  if (/åœ°æ¯¯|çª—ç°¾|åŒ…åŒ…|é‹/.test(message)) return 'ç‰¹æ®Šé …ç›®';
  if (/ç²¾å“|åç‰Œ|LV|Gucci|Chanel|Canada Goose|Moncler/.test(message)) return 'ç²¾å“é …ç›®';
  return 'å…¶ä»–';
}

// ====================================
// è™•ç†æ–‡å­—è¨Šæ¯ï¼ˆClaude AIï¼‰
// ====================================
async function handleTextMessage(userMessage, userId = null) {
  try {
    console.log(`ğŸ“© æ”¶åˆ°è¨Šæ¯: ${userMessage}`);
    console.log(`ğŸ“© è¨Šæ¯é•·åº¦: ${userMessage.length}`);
    console.log(`ğŸ“© è¨Šæ¯å‰50å­—: ${userMessage.substring(0, 50)}`);
    
    // éæ¿¾ 6å®®æ ¼å›ºå®šæ¨¡æ¿è¨Šæ¯
    const exactMatches = [
      'åˆ°åºœæ”¶é€', 'å¸¸è¦‹å•é¡Œ', 'ä»˜æ¬¾æ–¹å¼', 'å¸¸è¦‹å•é¡Œ&ä»˜æ¬¾æ–¹å¼',
      'æœå‹™åƒ¹ç›®', 'å„²å€¼å„ªæƒ ', 'æœå‹™åƒ¹ç›®&å„²å€¼å„ªæƒ ',
      'åº—é¢åœ°å€', 'ç‡Ÿæ¥­æ™‚é–“', 'åº—é¢åœ°å€&ç‡Ÿæ¥­æ™‚é–“',
      'æ™ºèƒ½æ±¡æ¼¬åˆ†æ', 'æ™ºèƒ½æ±™æ¼¬åˆ†æ', 'å¯¶å¯¶æ±½åº§&æ‰‹æ¨è»Š', 'é¡§å®¢é ˆçŸ¥'
    ];
    
    const partialMatches = [
      'é ç´„æ”¶é€,è«‹æä¾›ä»¥ä¸‹è¨Šæ¯',
      'è«‹æä¾›ä»¥ä¸‹è¨Šæ¯æˆ–é€²å…¥é€£çµé ç´„',
      'ä»¥åˆ©å°å¹«æ‰‹ç‚ºæ‚¨æœå‹™',
      'æ”¶ä»¶ä»¶æ•¸:',
      'æ„Ÿè¬æ‚¨ğŸ¤—',
      'æ±Ÿç¿ åŒ—èŠ³é„°ç„¡ä»¶æ•¸é™åˆ¶',
      'å…¨å¤©ç®¡ç†å®¤æ”¶é€',
      'éœ€è¦æ¸…æ½”çš„è¡£ç‰©æ”¾åœ¨ç®¡ç†å®¤',
      'å¤–æ”¶äººå“¡æœƒå¹«æ‚¨æ”¶é€',
      'ä»˜æ¬¾æ–¹å¼æœ‰ç¾é‡‘ğŸ’²è½‰å¸³ğŸ§line payğŸ…¿ä¿¡ç”¨å¡ğŸ’°'
    ];
    
    if (exactMatches.includes(userMessage.trim())) {
      console.log('ğŸ”‡ åµæ¸¬åˆ° 6å®®æ ¼è§¸ç™¼è©ï¼Œä¸å›è¦†');
      return null;
    }
    
    const isPartialMatch = partialMatches.some(phrase => userMessage.includes(phrase));
    if (isPartialMatch) {
      console.log('ğŸ”‡ åµæ¸¬åˆ° 6å®®æ ¼æ¨¡æ¿æ–‡å­—ï¼Œä¸å›è¦†');
      return null;
    }
    
    console.log('âœ… éæ¨¡æ¿è¨Šæ¯ï¼Œç¹¼çºŒè™•ç†');
    
    const now = new Date();
    const taipeiTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Taipei' }));
    const currentHour = taipeiTime.getHours();
    const currentDay = taipeiTime.getDay();
    const dayNames = ['é€±æ—¥', 'é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­'];
    const currentDayName = dayNames[currentDay];
    const timeInfo = `ç•¶å‰æ™‚é–“ï¼š${currentDayName} ${currentHour}:${taipeiTime.getMinutes().toString().padStart(2, '0')}`;
    
    const isPickupQuestion = /ä¾†æ”¶|æ”¶ä»¶|æ”¶è¡£|åˆ°åºœæ”¶|æ”¶é€|å¯ä»¥æ”¶å—|ä¾†æ‹¿|å–ä»¶/.test(userMessage);
    
    if (isPickupQuestion && userId && pickupRepliedUsers.has(userId)) {
      console.log('ğŸ”‡ å·²å›è¦†éæ”¶ä»¶å•é¡Œï¼Œä¸é‡è¤‡å›æ‡‰');
      return null;
    }
    
    // å–å¾—å°è©±è¨˜æ†¶
    const history = getHistory(userId);
    const messages = [];
    
    // åŠ å…¥æ­·å²å°è©±
    history.forEach(msg => {
      messages.push({
        role: msg.role,
        content: msg.content
      });
    });
    
    // åŠ å…¥ç•¶å‰è¨Šæ¯
    messages.push({
      role: "user",
      content: `${timeInfo}\n\nå®¢äººå•é¡Œï¼š${userMessage}`
    });
    
    console.log(`ğŸ“œ å°è©±è¨˜æ†¶: ${history.length} å‰‡æ­·å²è¨Šæ¯`);
    
    // åˆ¤æ–·å•é¡Œè¤‡é›œåº¦
    const isComplexQuestion = (
      /LV|Gucci|Chanel|HermÃ¨s|Hermes|Prada|Dior|Burberry|Coach|MK|Longchamp|Fendi|Celine|Canada Goose|Moncler|Arc|Patagonia|åŠ æ‹¿å¤§éµ|Loro Piana|Brunello Cucinelli|Tom Ford|The North Face/.test(userMessage) ||
      /æ€éº¼é€™éº¼ä¹…|æ´—é€™éº¼ä¹…|é‚„æ²’å¥½|å¤ªæ…¢|å¾ˆä¹…|éƒ½å¹¾å¤©äº†|è¶…é|å¿˜è¨˜|é‚„æ²’ä¾†|æ€éº¼é‚„æ²’|æ˜¯ä¸æ˜¯å¿˜äº†|æ²’ä¾†æ”¶|æ²’ä¾†æ‹¿|ä¸æ»¿æ„|ç”Ÿæ°£|å¤ªå·®|å¾ˆçˆ›|é€€è²»|æŠ•è¨´|æŠ±æ€¨/.test(userMessage) ||
      /é€åˆ°å®¶|é€å›|å®Œå·¥å¾Œ|ç´„é€å›æ™‚é–“|ç´„æ™‚é–“|æ–¹ä¾¿å”èª¿|å“ªå¾—è·Ÿæˆ‘èªªå€‹æ™‚é–“/.test(userMessage) ||
      (userMessage.includes('ï¼Ÿ') && userMessage.split('ï¼Ÿ').length > 2)
    );
    
    // é¸æ“‡æ¨¡å‹
    const modelToUse = isComplexQuestion 
      ? "claude-sonnet-4-20250514"
      : "claude-3-5-haiku-20241022";
    
    console.log(`ğŸ¤– ä½¿ç”¨æ¨¡å‹: ${modelToUse} (${isComplexQuestion ? 'è¤‡é›œå•é¡Œ' : 'ç°¡å–®å•é¡Œ'})`);
    
    const message = await anthropic.messages.create({
      model: modelToUse,
      max_tokens: 1500,
      system: LAUNDRY_KNOWLEDGE,
      messages: messages
    });

    let finalReply = message.content[0].text;
    
    // æª¢æŸ¥ä¸¦éæ¿¾ç¦æ­¢ç”¨èª
    const forbiddenPhrases = [
      'ä½œç‚ºAI', 'ä½œç‚ºå®¢æœ', 'æˆ‘æ˜¯AI', 'AIå®¢æœ',
      'æˆ‘ç„¡æ³•', 'æˆ‘ä¸èƒ½', 'æˆ‘æ²’æœ‰æ¬Šé™',
      'å»ºè­°æ‚¨ç›´æ¥è¯çµ¡', 'å»ºè­°æ‚¨è¯ç¹«åº—èˆ–', 'è«‹æ‚¨è‡ªå·±æŸ¥è©¢'
    ];

    const hasForbiddenPhrase = forbiddenPhrases.some(phrase => 
      finalReply.includes(phrase)
    );

    if (hasForbiddenPhrase) {
      console.log('âš ï¸ åµæ¸¬åˆ°ç¦æ­¢ç”¨èªï¼Œæ”¹ç”¨é è¨­å›è¦†');
      console.log(`åŸå§‹å›è¦†: ${finalReply}`);
      finalReply = 'å¥½çš„ ğŸ’™ ç‡Ÿæ¥­æ™‚é–“æœƒæœ‰å°ˆäººå¹«æ‚¨æŸ¥è©¢ä¸¦å›è¦†æ‚¨';
    }

    // è¨ˆç®—æˆæœ¬
    const inputTokens = message.usage.input_tokens;
    const outputTokens = message.usage.output_tokens;
    const costInfo = calculateCost(modelToUse, inputTokens, outputTokens);
    costInfo.model = modelToUse;

    console.log(`ğŸ’° æˆæœ¬è³‡è¨Š: ${modelToUse}`);
    console.log(`ğŸ“¥ Input tokens: ${inputTokens}`);
    console.log(`ğŸ“¤ Output tokens: ${outputTokens}`);
    console.log(`ğŸ’µ ç¸½æˆæœ¬: $${costInfo.totalCost}`);

    if (finalReply.includes('UNRELATED')) {
      console.log('ğŸ”‡ AI åˆ¤æ–·ç‚ºç„¡é—œå•é¡Œ');
      return null;
    }

    // å„²å­˜å°è©±è¨˜æ†¶
    addToHistory(userId, "user", userMessage);
    addToHistory(userId, "assistant", finalReply);

    if (isPickupQuestion && userId && finalReply) {
      pickupRepliedUsers.set(userId, Date.now());
    }

    // è¨˜éŒ„åˆ° Google Sheets
    const emotion = detectEmotion(userMessage);
    const questionType = detectQuestionType(userMessage);
    await logToGoogleSheets(userId, userMessage, finalReply, questionType, emotion, costInfo);

    console.log('âœ… AI å›è¦†æˆåŠŸ');
    return finalReply;

  } catch (error) {
    console.error('[Claude AI] éŒ¯èª¤:', error);
    return null;
  }
}

// ====================================
// è™•ç†åœ–ç‰‡è¨Šæ¯ï¼ˆClaude Visionï¼‰
// ====================================
async function handleImageMessage(imageBuffer) {
  try {
    console.log('ğŸ“¸ é–‹å§‹è™•ç†åœ–ç‰‡è¨Šæ¯');
    const base64Image = imageBuffer.toString('base64');
    
    const message = await anthropic.messages.create({
      model: "claude-sonnet-4-20250514",
      max_tokens: 500,
      messages: [{
        role: "user",
        content: [
          {
            type: "image",
            source: {
              type: "base64",
              media_type: "image/jpeg",
              data: base64Image
            }
          },
          {
            type: "text",
            text: "è«‹åˆ†æé€™å¼µè¡£ç‰©ç…§ç‰‡ä¸Šçš„æ±™æ¼¬é¡å‹,ä¸¦å»ºè­°æ¸…æ´—æ–¹å¼ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡ç°¡æ½”å›ç­”,åŒ…å«:1)æ±™æ¼¬é¡å‹ 2)å»ºè­°è™•ç†æ–¹å¼ 3)é ä¼°æ¸…æ´—æ•ˆæœ(ä½†è¦èªªæ˜ä¸ä¿è­‰å®Œå…¨å»é™¤)"
          }
        ]
      }]
    });

    const analysis = message.content[0].text;

    const replyMessage = `ğŸ” AI æ±™æ¼¬åˆ†æçµæœ\n\n${analysis}\n\nâš ï¸ é‡è¦æé†’:\næ±™æ¼¬è™•ç†ã€ä¸ä¿è­‰èƒ½å®Œå…¨å»é™¤ã€‘\nå¯¦éš›æ¸…æ´—æ•ˆæœéœ€ç”±å°ˆæ¥­å¸«å‚…è©•ä¼°\nè‹¥æ±™æ¼¬å·²æ·±å…¥çº–ç¶­æˆ–æ™‚é–“éä¹…ï¼Œå¯èƒ½ç„¡æ³•å®Œå…¨è™•ç†\n\nC.H ç²¾ç·»æ´—è¡£ ğŸ’™`;

    console.log('âœ… åœ–ç‰‡åˆ†æå®Œæˆ');
    return replyMessage;

  } catch (error) {
    console.error('[Claude Vision] åœ–ç‰‡åˆ†æéŒ¯èª¤:', error);
    return 'æ„Ÿè¬æ‚¨æä¾›ç…§ç‰‡!æˆ‘å€‘çš„å°ˆæ¥­å¸«å‚…æœƒä»”ç´°è©•ä¼°æ±™æ¼¬ç‹€æ³ã€‚\n\nâš ï¸ æé†’:æ±™æ¼¬è™•ç†ä¸ä¿è­‰èƒ½å®Œå…¨å»é™¤ ğŸ’™';
  }
}

module.exports = {
  handleTextMessage,
  handleImageMessage
};
